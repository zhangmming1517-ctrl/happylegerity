# PRD：AI 极简饮食规划助手

## 1. 产品概述

| 项目 | 说明 |
|------|------|
| **产品名称** | AI 极简饮食规划助手（Legerity） |
| **定位** | 基于 Google Gemini 的**一周饮食规划 + 采购清单**生成工具，面向健康人群的饮食参考（非医疗） |
| **形态** | PWA 单页应用，支持离线、响应式、可添加到 iOS 主屏 |

---

## 2. 目标用户

- 追求健康、希望控制热量与营养的普通用户  
- 需要「一周吃什么 + 买什么」的决策辅助  
- 有「清冰箱」或「按口味采买」两种典型使用场景  

---

## 3. 核心功能（一句话）

- **健康数据**：根据年龄、性别、身高、体重、运动水平 → 计算 BMI、TDEE、目标热量（减重/减脂/增肌）  
- **双模式规划**：**采买模式**（按口味生成购物清单）/ **清冰箱模式**（基于现有食材最大化利用）  
- **AI 周计划**：Gemini 生成 7 天早/午/晚三餐 + 聚合购物清单 + 调料 + 精简做法（每道菜约 3 步）  
- **RAG 增强**：本地营养知识库（食材热量/蛋白/脂肪/碳水）参与 prompt，提升分量与搭配合理性  
- **结果使用**：查看三餐安排与购物清单、复制整份方案、查看「具体做法」弹窗  

---

## 4. 关键用户流程

```
首次使用 →  onboarding（身体数据 + 运动水平 + 忌口）→ 保存
                ↓
首页 home → 查看 BMI/TDEE/建议摄入 + 选择本周目标（减重/减脂/增肌）
                ↓
选择模式 → 采买模式 或 清冰箱模式 → 进入 plan_input
                ↓
plan_input → 口味偏好、食材种类上限、是否允许重复、食材说明（想吃/已有）→ 一键生成
                ↓
result → 三餐安排 + 购物清单 + 调料 → 复制 / 查看具体做法 / 重新生成
```

---

## 5. 功能要点（必读）

| 模块 | 关键规则/约束 |
|------|----------------|
| **用户画像** | 年龄、性别、身高、体重、运动水平（4 档）、目标（减重/减脂/增肌）、长期忌口；本地持久化 |
| **健康计算** | BMR（Mifflin-St Jeor）→ TDEE → 按目标加减热量；BMI 分类：偏瘦/正常/超重/肥胖 |
| **采买模式** | 可选填「本周想吃的食材」；生成整周购物清单（种类可设上限）；一材多做法、控制品种数 |
| **清冰箱模式** | 必填「已有食材」；清单中已有项可标「(可选/已有)」；最大化利用库存 |
| **AI 约束** | 禁搭配禁忌；少油少盐；早餐符合日常习惯；午餐/晚餐须有主食+菜+蛋白+适量脂肪；portion 与 name 一一对应、单位克/ml |
| **RAG** | 从 `foodNutrition` 按关键词+常驻基础条目检索，格式化后注入 prompt，最多 50 条 |
| **输出结构** | dailyPlans（day + breakfast/lunch/dinner：name, calories, portion）、shoppingList（name, amount）、seasonings、recipes（dishName, steps） |

---

## 6. 技术要点（与产品强相关）

- **前端**：React 19 + TypeScript + Vite 6；Tailwind；PWA（Workbox）。  
- **AI**：Google GenAI（Gemini），`gemini-3-flash-preview`，JSON Schema 约束输出。  
- **RAG**：本地 `FOOD_NUTRITION_DB` + `ragNutrition.ts` 关键词匹配，无向量库。  
- **安全**：API Key 通过 `VITE_GEMINI_API_KEY` 注入；生产需后端代理，前端不暴露 Key。  

---

## 7. 非功能与合规

- **免责**：AI 生成内容仅供健康饮食参考，非医疗建议；过敏与基础病患者需自行核实或咨询医生。  
- **环境**：Node 18+；需配置 Gemini API Key（见 API_KEY_SETUP.md）。  
- **部署**：支持本地预览、同局域网 PWA、ngrok 隧道、Vercel/Netlify 等 HTTPS 托管。  

---

*文档覆盖当前代码与 README 的共识，随产品迭代可增删章节。*
